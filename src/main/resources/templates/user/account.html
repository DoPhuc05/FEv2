<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<title>Hoàng Minh TRAVELER</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Free HTML Templates" name="keywords">
<meta content="Free HTML Templates" name="description">

<!-- Favicon -->
<link href="public/img/favicon.ico" rel="icon">

<!-- Google Web Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
	rel="stylesheet">

<!-- Font Awesome -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
	rel="stylesheet">

<!-- Libraries Stylesheet -->
<link href="public/lib/owlcarousel/assets/owl.carousel.min.css"
	rel="stylesheet">
<link
	href="public/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css"
	rel="stylesheet" />

<!-- Customized Bootstrap Stylesheet -->
<link href="public/css/style.css" rel="stylesheet">
</head>

<body>


	<!-- Topbar Start -->
	<div class="container-fluid bg-light pt-3 d-none d-lg-block">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 text-center text-lg-left mb-2 mb-lg-0">
					<div class="d-inline-flex align-items-center">
						<p>
							<i class="fa fa-envelope mr-2"></i>info@example.com
						</p>
						<p class="text-body px-3">|</p>
						<p>
							<i class="fa fa-phone-alt mr-2"></i>+012 345 6789
						</p>
					</div>
				</div>
				<div class="col-lg-6 text-center text-lg-right">
					<div class="d-inline-flex align-items-center">
						<a class="text-primary px-3" href=""> <i
							class="fab fa-facebook-f"></i>
						</a> <a class="text-primary px-3" href=""> <i
							class="fab fa-twitter"></i>
						</a> <a class="text-primary px-3" href=""> <i
							class="fab fa-linkedin-in"></i>
						</a> <a class="text-primary px-3" href=""> <i
							class="fab fa-instagram"></i>
						</a> <a class="text-primary pl-3" href=""> <i
							class="fab fa-youtube"></i>
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Topbar End -->


	<!-- Navbar Start -->
	<div class="container-fluid position-relative nav-bar p-0">
		<div class="container-lg position-relative p-0 px-lg-3"
			style="z-index: 9;">
			<nav
				class="navbar navbar-expand-lg bg-light navbar-light shadow-lg py-3 py-lg-0 pl-3 pl-lg-5">
				<a href="" class="navbar-brand">
					<h1 class="m-0 text-primary">
						<span class="text-dark">HOÀNG MINH</span> TOUR
					</h1>
				</a>
				<button type="button" class="navbar-toggler" data-toggle="collapse"
					data-target="#navbarCollapse">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse justify-content-between px-3"
					id="navbarCollapse">
					<div class="navbar-nav ml-auto py-0">
						<a href="/" class="nav-item nav-link active">Trang chủ</a> <a
							href="/tour/trong-nuoc" class="nav-item nav-link">Tour trong
							nước</a> <a href="/tour/ngoai-nuoc" class="nav-item nav-link">Tour
							ngoài nước</a> <a href="/tin-tuc" class="nav-item nav-link">Tin
							tức</a> <a href="/lien-he" class="nav-item nav-link">Liên hệ</a> <a
							href="/account" class="nav-item nav-link">Tài khoản</a>
					</div>
				</div>
			</nav>
		</div>
	</div>

	<!-- Contact Start -->
	<div class="container-fluid py-5">
		<div class="container py-5">
			<div class="text-center mb-3 pb-3">
				<h6 class="text-primary text-uppercase" style="letter-spacing: 5px;">Tài
					khoản</h6>
				<h1>Thông tin tài khoản</h1>
			</div>
			
			<!-- Hiển thị form đăng nhập nếu chưa đăng nhập -->
			<div th:if="${user == null}" class="row justify-content-center">
				<div class="col-lg-6">
					<div class="contact-form bg-white" style="padding: 30px;">
						<div class="text-center mb-4">
							<h4>Đăng nhập vào hệ thống</h4>
							<p class="text-muted">Vui lòng đăng nhập để xem thông tin tài khoản</p>
						</div>
						
						<!-- Tab Navigation -->
						<ul class="nav nav-tabs" id="loginTabs" role="tablist">
							<li class="nav-item" role="presentation">
								<button class="nav-link active" id="user-tab" data-toggle="tab" data-target="#user-login" type="button" role="tab">
									<i class="fa fa-user mr-2"></i>Khách hàng
								</button>
							</li>
							<li class="nav-item" role="presentation">
								<button class="nav-link" id="admin-tab" data-toggle="tab" data-target="#admin-login" type="button" role="tab">
									<i class="fa fa-user-shield mr-2"></i>Quản trị viên
								</button>
							</li>
						</ul>
						
						<!-- Tab Content -->
						<div class="tab-content mt-3" id="loginTabContent">
							<!-- User Login Tab -->
							<div class="tab-pane fade show active" id="user-login" role="tabpanel">
								<form id="userLoginForm">
									<div class="form-group">
										<input type="text" class="form-control p-4" id="userUsername" placeholder="Tên đăng nhập" required>
									</div>
									<div class="form-group">
										<input type="password" class="form-control p-4" id="userPassword" placeholder="Mật khẩu" required>
									</div>
									<div class="text-center">
										<button type="button" class="btn btn-primary py-3 px-4" onclick="userLogin()">Đăng nhập</button>
									</div>
									<div class="text-center mt-3">
										<a href="/register" class="text-primary">Chưa có tài khoản? Đăng ký ngay</a>
									</div>
								</form>
							</div>
							
							<!-- Admin Login Tab -->
							<div class="tab-pane fade" id="admin-login" role="tabpanel">
								<form id="adminLoginForm">
									<div class="form-group">
										<input type="text" class="form-control p-4" id="adminUsername" placeholder="Tên đăng nhập admin" required>
									</div>
									<div class="form-group">
										<input type="password" class="form-control p-4" id="adminPassword" placeholder="Mật khẩu admin" required>
									</div>
									<div class="text-center">
										<button type="button" class="btn btn-danger py-3 px-4" onclick="adminLogin()">Đăng nhập Admin</button>
									</div>
								</form>
							</div>
						</div>
						
						<div id="loginMessage" class="mt-3"></div>
					</div>
				</div>
			</div>
			
			<!-- Hiển thị thông tin tài khoản nếu đã đăng nhập -->
			<div th:if="${user != null}" class="row justify-content-center">
				<div class="col-lg-8">
					<div class="contact-form bg-white" style="padding: 30px;">
						<div id="help-block text-succces" style="color:green;" th:if="${message != null}">[[${message}]]</div>
						
						<!-- Hiển thị nút Admin Dashboard nếu là admin -->
						<div th:if="${user.role_id == 1}" class="align-content-end py-4">
							<a class="btn btn-danger py-3 px-4 mr-2" href="/admin/index">
								<i class="fa fa-cog mr-2"></i>Quản lý hệ thống
							</a>
							<a class="btn btn-primary py-3 px-4" href="/user/tour">
								<i class="fa fa-list mr-2"></i>Quản lý tour đã đặt
							</a>
						</div>
						
						<!-- Hiển thị nút User Dashboard nếu là user thường -->
						<div th:if="${user.role_id != 1}" class="align-content-end py-4">
							<a class="btn btn-primary py-3 px-4" href="/user/tour">
								<i class="fa fa-list mr-2"></i>Quản lý tour đã đặt
							</a>
						</div>
						
						<form name="sentMessage"  method="post" action="/updateAccount"
							id="contactForm" novalidate="novalidate">
							<div class="form-row">
								<div class="control-group col-sm-6">
									<input type="text" class="form-control p-4" id="username"
										disabled="disabled" name="username" th:value="${user.username}"
										placeholder="Tên người dùng" required="required"
										data-validation-required-message="Vui lòng nhập tên người dùng" />
									<p class="help-block text-danger"></p>
								</div>
								<div class="control-group col-sm-6">
									<input type="text" class="form-control p-4" name="ho_ten" id="email" placeholder="Họ tên"
										required="required" th:value="${user.ho_ten}"
										data-validation-required-message="Vui lòng nhập họ và tên"
										disabled="disabled" />
									<p class="help-block text-danger"></p>
								</div>
							</div>
							<div class="control-group">
								<input type="email" class="form-control p-4" name="email"
									id="subjectd" placeholder="Email" required="required"
									disabled="disabled" th:value="${user.email}"
									data-validation-required-message="Vui lòng nhập email" />
								<p class="help-block text-danger"></p>
							</div>
							<div class="form-row">
								<div class="control-group col-sm-6">
									<input type="tel" class="form-control p-4" id="name" name="sdt"
										placeholder="Số điện thoại" required="required"
										disabled="disabled" th:value="${user.sdt}"
										data-validation-required-message="Vui lòng nhập số điện thoại" />
									<p class="help-block text-danger"></p>
								</div>
								<div class="control-group col-sm-6">
									<div class="mb-3 mb-md-0">
										<select class="custom-select px-4" id="select-gender" disabled="disabled"
											name="gioi_tinh" th:value="${user.gioi_tinh}" style="height: 47px;">
											<option value="Nam">Nam</option>
											<option value="Nữ">Nữ</option>
										</select>
									</div>
								</div>
							</div>
							<div class="control-group">
								<input type="text" class="form-control p-4" name="dia_chi"
									id="subject" placeholder="Địa chỉ" required="required"
									disabled="disabled" th:value="${user.dia_chi}"
									data-validation-required-message="Vui lòng nhập địa chỉ" />
								<p class="help-block text-danger"></p>
							</div>
							<div class="text-center">
								<button class="btn btn-primary py-3 px-4"
									id="sendMessageButton">Cập nhật thông tin tài khoản</button>
							</div>
							<div class="control-group d-flex justify-content-between">
								<a href="/changepassword" class="pt-4 d-block">Đổi mật khẩu</a>
								<a href="/logout" onclick="return confirm('Bạn có chắc chắn đăng xuất');" class="text-danger pt-4 d-block">Đăng xuất</a>									
							</div>
						</form>
						
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Contact End -->

	<!-- Footer Start -->
	<div class="container-fluid bg-dark text-white-50 py-5 px-sm-3 px-lg-5"
		style="margin-top: 90px;">
		<div class="row pt-5">
			<div class="col-lg-4 col-md-6 mb-5">
				<a href="" class="navbar-brand">
					<h1 class="text-primary">
						<span class="text-white">HOANGMINH</span> TOUR
					</h1>
				</a>
				<p>Công ty dịch vụ du lịch và vận chuyển Hoàng Minh</p>
				<h6 class="text-white text-uppercase mt-4 mb-3"
					style="letter-spacing: 5px;">Theo dõi chúng tôi</h6>
				<div class="d-flex justify-content-start">
					<a class="btn btn-outline-primary btn-square mr-2" href="#"><i
						class="fab fa-twitter"></i></a> <a
						class="btn btn-outline-primary btn-square mr-2" href="#"><i
						class="fab fa-facebook-f"></i></a> <a
						class="btn btn-outline-primary btn-square mr-2" href="#"><i
						class="fab fa-linkedin-in"></i></a> <a
						class="btn btn-outline-primary btn-square" href="#"><i
						class="fab fa-instagram"></i></a>
				</div>
			</div>
			<div class="col-lg-4 col-md-6 mb-5">
				<h5 class="text-white text-uppercase mb-4"
					style="letter-spacing: 5px;">Dịch vụ của chúng tôi</h5>
				<div class="d-flex flex-column justify-content-start">
					<a class="text-white-50 mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Về chúng tôi</a> <a
						class="text-white-50 mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Đặt tour</a> <a
						class="text-white-50 mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Liên hệ</a> <a
						class="text-white-50 mb-2" href="#"><i
						class="fa fa-angle-right mr-2"></i>Tin tức</a>
				</div>
			</div>
			<div class="col-lg-4 col-md-6 mb-5">
				<h5 class="text-white text-uppercase mb-4"
					style="letter-spacing: 5px;">Liên hệ với chúng tôi</h5>
				<p>
					<i class="fa fa-map-marker-alt mr-2"></i>216 Đường Cầu Diễn , Bắc
					Từ Liêm , Hà Nội
				</p>
				<p>
					<i class="fa fa-phone-alt mr-2"></i>+012 345 67890
				</p>
				<p>
					<i class="fa fa-envelope mr-2"></i>info@example.com
				</p>
				<h6 class="text-white text-uppercase mt-4 mb-3"
					style="letter-spacing: 5px;">Newsletter</h6>
				<div class="w-100">
					<div class="input-group">
						<input type="text" class="form-control border-light"
							style="padding: 25px;" placeholder="Your Email">
						<div class="input-group-append">
							<button class="btn btn-primary px-3">Sign Up</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div
		class="container-fluid bg-dark text-white border-top py-4 px-sm-3 px-md-5"
		style="border-color: rgba(256, 256, 256, .1) !important;">
		<div class="row">
			<div class="col-lg-6 text-center text-md-left mb-3 mb-md-0">
				<p class="m-0 text-white-50">
					Copyright &copy; <a href="#">Domain</a>. All Rights Reserved.</a>
				</p>
			</div>
			<div class="col-lg-6 text-center text-md-right">
				<p class="m-0 text-white-50">
					Designed by <a href="https://htmlcodex.com">HTML Codex</a>
				</p>
			</div>
		</div>
	</div>
	<!-- Footer End -->




	<!-- Back to Top -->
	<a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i
		class="fa fa-angle-double-up"></i></a>


	<!-- JavaScript Libraries -->
	<script src="/public/js/boostrap-bundle.min.js"></script>
	<script src="/public/js/jquery.js"></script>
	<script src="public/lib/easing/easing.min.js"></script>
	<script src="public/lib/owlcarousel/owl.carousel.min.js"></script>
	<script src="public/lib/tempusdominus/js/moment.min.js"></script>
	<script src="public/lib/tempusdominus/js/moment-timezone.min.js"></script>
	<script
		src="public/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

	<!-- Contact Javascript File -->
	<script src="public/mail/jqBootstrapValidation.min.js"></script>

	<!-- Template Javascript -->
	<script src="public/js/main.js"></script>
	<script type="text/javascript">
		// Xử lý cập nhật thông tin tài khoản
		document.getElementById("sendMessageButton").onclick = function (e) {
			e.preventDefault();
			if(document.getElementById("username").disabled) {
				document.getElementById("select-gender").removeAttribute("disabled");
				var inputs = document.querySelectorAll("input");
				for (var i = 0; i < inputs.length; i++) {
					inputs[i].removeAttribute("disabled");
				}
			}else {
				document.getElementById("contactForm").submit();
			}
		};
		
		// Hàm đăng nhập user
		function userLogin() {
			var username = document.getElementById('userUsername').value;
			var password = document.getElementById('userPassword').value;
			
			if(username == '' || password == '') {
				showMessage('Vui lòng nhập đầy đủ thông tin!', 'danger');
				return;
			}
			
			var info = {
				username: username,
				password: password
			};
			
			$.ajax({
				url: "/api/auth/login",
				type: "POST",
				contentType: 'application/json',
				data: JSON.stringify(info),
				success: function(data) {
					if(data.data != null) {
						if(data.data.role === 'ADMIN') {
							window.location.href = '/admin/index';
						} else {
							window.location.href = '/account';
						}
					} else {
						showMessage(data.message, 'danger');
					}
				},
				error: function() {
					showMessage('Có lỗi xảy ra, vui lòng thử lại!', 'danger');
				}
			});
		}
		
		// Hàm đăng nhập admin
		function adminLogin() {
			var username = document.getElementById('adminUsername').value;
			var password = document.getElementById('adminPassword').value;
			
			if(username == '' || password == '') {
				showMessage('Vui lòng nhập đầy đủ thông tin!', 'danger');
				return;
			}
			
			var info = {
				username: username,
				password: password
			};
			
			$.ajax({
				url: "/api/auth/login",
				type: "POST",
				contentType: 'application/json',
				data: JSON.stringify(info),
				success: function(data) {
					if(data.data != null) {
						if(data.data.role === 'ADMIN') {
							window.location.href = '/admin/index';
						} else {
							showMessage('Tài khoản này không có quyền admin!', 'danger');
						}
					} else {
						showMessage(data.message, 'danger');
					}
				},
				error: function() {
					showMessage('Có lỗi xảy ra, vui lòng thử lại!', 'danger');
				}
			});
		}
		
		// Hàm hiển thị thông báo
		function showMessage(message, type) {
			var alertClass = type === 'danger' ? 'alert-danger' : 'alert-success';
			var html = '<div class="alert ' + alertClass + ' alert-dismissible fade show" role="alert">' +
						message +
						'<button type="button" class="close" data-dismiss="alert">' +
						'<span>&times;</span></button></div>';
			document.getElementById('loginMessage').innerHTML = html;
		}
	</script>
</body>

</html>
